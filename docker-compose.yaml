services:
    proxy:
      image: jwilder/nginx-proxy
      ports:
        - 80:80
      volumes: 
        - /var/run/docker.sock:/tmp/docker.sock:ro

    frontend:
        image: yaharuott/url_shortener_test_frontend
        build: 
          context: ./frontend
          dockerfile: Dockerfile
        environment:
          - VIRTUAL_HOST=yaharuott.ru
        depends_on:
          - backend
    backend:
        image: yaharuott/url_shortener 
        build: .
        environment:
          - SERVICE_PORT=8080
          - LENGTH_GEN=8
          - DB_NAME=link_shortener
          - DB_PORT=3306
          - DB_HOST=database
          - DB_PASS=1212!!AaLXX
          - DB_USER=root
          - VIRTUAL_HOST=api.yaharuott.ru
          - VIRTUAL_PORT=8080
        depends_on: 
          - database
        restart: on-failure
    database:
        image: mysql:8.4
        environment:
          - MYSQL_ROOT_PASSWORD=1212!!AaLXX
          - MYSQL_DATABASE=link_shortener
